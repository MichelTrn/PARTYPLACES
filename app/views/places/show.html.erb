
<div class="container mt-5">
  <p><strong>Places detail</strong></p>

  <div class="row">
    <div class="col">
      <div class="card p-3 mt-3">
        <div class="card-product">
          <%if @place.photo.attached? %>
            <%= cl_image_tag @place.photo.key, height: 300, width: 300, crop: :fill %>
          <%elsif @place.picture_url%>
            <%= image_tag @place.picture_url, class: "object-fit: cover" %>
          <%else%>
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/1024px-No_image_available.svg.png"/>
          <%end%>
          <div class="card-product-infos">
            <h2><%= @place.name %> </h2>
            <p><%= @place.address%> </p>
            <p><%= @place.price %> â‚¬ </p>
            <% if user_signed_in? && current_user.id == @place.user_id %>
              <button class="btn btn-outline-primary"><%= link_to "Delete this place", place_path,  data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %></button>
              <button class="btn btn-outline-primary"><%= link_to "Edit this place", edit_place_path %></button>
            <% end %>
          </div>
            <div style="width: 420px; height: 400px;"
              data-controller="map"
              data-map-markers-value="<%= @markers.to_json %>"
              data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
               <%= render 'shared/marker' %>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>


<% if user_signed_in? && @bookings.count > 0 && current_user.id == @place.user_id%>
  <div class="container mt-5 border">
    <p><strong>Bookings detail</strong></p>
      <div class="row">
        <div class="col">
          <div class="card p-3 mt-3">
            <% @bookings.each do |booking| %>
              <div class="card-product-infos d-flex justify-content-center space-evenly">
                <div class="booking border p-2 bg-light">

                    <% if booking.status == 'refused' %>
                      <p class = 'btn btn-danger me-3 mt-2'><strong>Status : </strong><%= booking.status %></p>
                      <% elsif booking.status =='pending confirmation'  %>
                      <p class = 'btn btn-warning me-3 mt-2'><strong>Status : </strong><%= booking.status %></p>
                      <% elsif booking.status =='booked'  %>
                      <p class = 'btn btn-success me-3 text-center mt-2'><strong>Status : </strong><%= booking.status %></p>
                    <% end %>

                  <div>
                      <p class = 'me-3 mt-3'><strong> Beginning of the reservation :</strong> <%= booking.begin_date %></p>
                      <p class = 'me-3 mt-3'><strong>End of the reservation :</strong> <%= booking.end_date %></p>
                  </div>
                  <% if booking.status == 'pending confirmation' %>
                    <div class="buttons d-flex">
                      <div class="button m-0 h-25 me-2">
                        <%= simple_form_for booking do |f|%>
                          <%= f.input :status, as: :hidden, input_html: { value: 'booked'} %>
                          <%= f.submit 'Accept', class: 'btn btn-outline-success' %>
                        <% end %>
                      </div>
                      <div class="button me-2">
                        <%= simple_form_for booking do |f| %>
                          <%= f.input :status, as: :hidden, input_html: { value: 'refused'}, class: 'p-0'%>
                          <%= f.submit 'Reject', class: 'btn btn-outline-danger' %>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
  </div>
<% end %>

<% if user_signed_in? && @bookings.count > 0 && current_user.id != @place.user_id%>
  <div class="container mt-5 border">
    <p><strong>Bookings detail</strong></p>
      <div class="row">
        <div class="col">
          <div class="card p-3 mt-3">
            <% @bookings.each do |booking| %>
              <div class="card-product-infos d-flex justify-content-center space-evenly">
                <div class="booking border p-2 bg-light">
                  <% if booking.status == 'pending confirmation' %>
                  <div>
                      <p class = 'me-3 mt-3'><strong> Beginning of the reservation :</strong> <%= booking.begin_date %></p>
                      <p class = 'me-3 mt-3'><strong>End of the reservation :</strong> <%= booking.end_date %></p>
                  </div>
                    <div class="buttons d-flex">
                      <div class="button m-0 h-25 me-2">
                        <p class = 'btn btn-warning me-3 mt-2'><strong>Status : </strong><%= booking.status %></p>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
  </div>
<% end %>

<% if user_signed_in? && current_user.id != @place.user_id %>
  <%= link_to "Book this place", new_place_booking_path(@place) %>
<% end %>
